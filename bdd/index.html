<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Global Standings</title>
  <style>
    :root{
      --bg:#0f1724;
      --muted:#9aa6bf;
      --master:#55b200;
      --gold:#e5b019;
      --silver:#9d9894;
      --bronze:#a35d29;
      --unranked:#6b7280;
      --radius:10px;
      font-family: Inter, ui-sans-serif, system-ui;
    }

    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071020 0%, #04121b 100%);color:#ecf2ff}
    .wrap{max-width:900px;margin:32px auto;padding:20px}
    header h1{font-size:22px;margin:0 0 16px 0}
    .card{background:rgba(255,255,255,0.03);padding:18px;border-radius:var(--radius)}

    .controls{display:flex;gap:10px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
    .controls input[type=text]{padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--muted);min-width:240px}
    .controls label{color:var(--muted);font-size:13px}
    .controls select{padding:6px 8px;border-radius:8px;background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)}

    table{width:100%;border-collapse:collapse;font-size:14px}
    thead th{background:rgba(255,255,255,0.05);text-align:left;padding:10px;font-weight:600;color:var(--muted)}
    tbody tr{border-bottom:1px solid rgba(255,255,255,0.05)}
    td{padding:10px}

    .separator{background:rgba(255,255,255,0.08);font-weight:700;text-transform:uppercase;letter-spacing:1px;height: 1px;}
    .separator.master{color:var(--master)}
    .separator.gold{color:var(--gold)}
    .separator.silver{color:var(--silver)}
    .separator.bronze{color:var(--bronze)}
    .separator.unranked{color:var(--unranked)}

    .player-row td{padding-left:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Global Standings</h1>
    </header>
    <div class="card">
      <div class="controls">
        <label>Recherche : <input id="filter" type="text" placeholder="Nom du joueur ou rang..." /></label>
        <label style="margin-left:auto;color:var(--muted)">Afficher les :
          <select id="show">
            <option value="all">Tous</option>
            <option value="master">Master</option>
            <option value="gold">Gold</option>
            <option value="silver">Silver</option>
            <option value="bronze">Bronze</option>
            <option value="unranked">Non class√©s</option>
          </select>
        </label>
      </div>

      <table id="board" aria-label="Tableau de classement">
        <thead>
          <tr>
            <th>Rang</th>
            <th>Joueur</th>
            <th>Points</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const config = {
      masterMax: 4,
      goldMax: 12,
      silverMax: 24,
      bronzeMax: 40
    };

    function leagueForRank(rank){
      if(rank <= config.masterMax) return 'master';
      if(rank <= config.goldMax) return 'gold';
      if(rank <= config.silverMax) return 'silver';
      if(rank <= config.bronzeMax) return 'bronze';
      return 'unranked';
    }

    const leagueIcons = {
      master: "Master3.png",
      gold:   "Gold3.png",
      silver: "Argent2.png",
      bronze: "Bronze1.png",
      unranked:"Unranked.png"
    };

    const tbody = document.querySelector('#board tbody');
    let players = [];

    function render(list){
      tbody.innerHTML = '';
      let currentLeague = '';
      for(const p of list){
        const lg = leagueForRank(p.rank);
        if(lg !== currentLeague){
          currentLeague = lg;
          const trSep = document.createElement('tr');
          trSep.className = `separator ${lg}`;
          const tdSep = document.createElement('td');
          tdSep.colSpan = 3;
          const icon = leagueIcons[lg] || leagueIcons.unranked;
          tdSep.innerHTML = `<img src="${icon}" alt="${lg}" style="width:28px;height:28px;vertical-align:middle;margin-right:8px;"> ${lg.toUpperCase()}`;
          trSep.appendChild(tdSep);
          tbody.appendChild(trSep);
        }
        const tr = document.createElement('tr');
        tr.className = 'player-row';
        tr.innerHTML = `<td>${p.rank}</td><td>${p.name}</td><td>${p.score}</td>`;
        tbody.appendChild(tr);
      }
    }

    function applyFilters(){
      const q = filterInput.value.trim().toLowerCase();
      const show = showSel.value;
      const filtered = players.filter(p => {
        const league = leagueForRank(p.rank);
        const matchShow = (show === 'all') || (league === show);
        const matchQuery = q === '' || p.name.toLowerCase().includes(q) || String(p.rank) === q;
        return matchShow && matchQuery;
      });
      render(filtered);
    }

    const filterInput = document.getElementById('filter');
    const showSel = document.getElementById('show');
    filterInput.addEventListener('input', applyFilters);
    showSel.addEventListener('change', applyFilters);

    // === Fetch depuis la base MySQL via PHP ===
    fetch('get_players.php')
      .then(res => res.json())
      .then(data => {
        players = data;
        render(players);
      })
      .catch(err => console.error('Erreur:', err));
  </script>
</body>
</html>
